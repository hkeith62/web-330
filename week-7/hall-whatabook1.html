<!--
    Title: WEB 330 – Enterprise JavaScript II
    Author: Professor Itskovich
    Date: 09/15/2021
    Modified By: Keith Hall
    Description: This is the HTML/Javascript file for web-330 assignment 7.2- What-A-Book App.  
-->
<!DOCTYPE html>
<html lang="en"> 
<head>
<meta charset="UTF-8" /> 
    <title>WEB 330 – Enterprise JavaScript II</title>
    <meta name="description" content="Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua." />
    <meta name="keywords" content="Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum." />
    <meta name="robots" content="noindex" />
    <meta name="author" content="Keith Hall" />
    <!-- Bootstrap css-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
    <!--Style Sheets-->
    <link rel="stylesheet" href="theme.css" />
    <link rel="stylesheet" href="site.css" />
    <!-- Font Awesome and Google Fonts -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;500;700&display=swap" rel="stylesheet" />
 </head>
 <body>
    <div class="assign-container"> <!-- Card containers-->
	    <h1 id= "app-header">Welcome to the WhatABook, Part 1 App</h1>
	    <div class="assign-content"> 
		    <div class="card">
			<div class="card-title" style="margin-bottom: 6px;">Book Listing</div>
	            <div class="card-content" id="bookList"> <!-- XML table bound here -->
		
                    <tr>
                        <th></th>
                        <th></th>
				        <th></th>
				        <th></th>
				        <th></th>
                    </tr>
			    </div>
            </div>
		<div id= "return-home-container">
            <a href= "../index.html" class="return-home">Return</a>
        </div> 
		</div>
    </div>
	<div class="assign-container" id="results">
	    <div class="assign-content">
		    <div class="card">
			    <div class="card-title">Selected Book</div>
                <!-- Click results bound here -->
			    <div class="card-content" id="selectedBook" class="card-content-text"></div> 
			</div>
		</div>
	</div>
<script>
    const fileName = "books.xml";
        let bookData, xmlData;
        window.addEventListener("DOMContentLoaded", function (event) {  // Event listener for "clicks."
            getBookData()
            .then(() => {
                parseData();
            })
        });

    const getBookData = () => {
        return fetch(fileName)
        .then(res => res.text())
        .then(data => bookData = data);
    }

    const parseData = () => {
	
        const domParser = new DOMParser();
        const xmlBooks = domParser.parseFromString(bookData,"text/xml");

            loadBooks(xmlBooks);
            addIsbnClickEvents();
    }

    const loadBooks = (xmlData) => {
    const books = xmlData.getElementsByTagName("book");

        let tableData = `<table id="bookTable" class="table"><tbody>`;
                    
            for (let book of books){
			
                const isbn = book.getElementsByTagName("isbn")[0].childNodes[0].nodeValue;
                const title = book.getElementsByTagName("title")[0].childNodes[0].nodeValue;
                const description = book.getElementsByTagName("description")[0].childNodes[0].nodeValue;
                const pages = book.getElementsByTagName("pages")[0].childNodes[0].nodeValue;
                const authors = book.getElementsByTagName("authors")[0].childNodes[0].nodeValue;

                    tableData += `<tr>
                        <td data-value="ISBN"><a href="#" class="isbn-link">${isbn}</a></td>
                        <td data-value="Title">${title}</td>
                        <td data-value="Description">${description}</td>
                        <td data-value="Pages">${pages}</td>
                        <td data-value="Authors">${authors}</td>
                        </tr>`;
            }	
            tableData += "</tbody></table>";
            document.getElementById("bookList").innerHTML = tableData;
    }
</script>
</body>
</html>